<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="login-container">
        <h1>Welcome to the Pomodoro Tracker</h1>
        <a href="/login"><button>Login</button></a>
        <a href="/register"><button>Register</button></a>

        <!-- Settings Form -->
        <form id="settingsForm" action="/start_pomodoro" method="post">
            <h2>Set Your Intervals</h2>
            <label>Work Interval (minutes): <input type="number" name="workInterval" id="workInput" value="25"></label><br>
            <label>Short Break (minutes): <input type="number" name="shortBreakInterval" id="shortBreakInput" value="5"></label><br>
            <label>Long Break (minutes): <input type="number" name="longBreakInterval" id="longBreakInput" value="15"></label><br>
            <input type="submit" value="Start Using Pomodoro">
        </form>
        
        <!-- Pomodoro Timer Display -->
        <div id="timer">25:00</div>

        <!-- Pomodoro Controls, now hidden initially -->
        <div id="pomodoroControls" style="display:none;">
            <button id="pomodoroButton" type="button" onclick="togglePomodoro()">Start Pomodoro</button>
            <button id="modeButton" type="button" onclick="changeMode()">Short Break</button>
            <button type="button" onclick="resetTimer()">Reset Timer</button>
        </div>
    </div>

    <div class="db-operations-container">
        <a href="/user_settings"><button>View User Settings</button></a>
        <a href="/sql_join"><button>SQL Join Operation</button></a>
        <a href="/stored_procedure"><button>Stored Procedure Execution</button></a>
        <a href="/trigger_operation"><button>Trigger Operation</button></a>
    </div>

    <script>
        var workTime = null;
        var shortBreak = null;
        var longBreak = null;
        var currentTimer = 0; // Initially set to 0
        var isTimerRunning = false;
        var interval;
        var mode = 'work'; 

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('settingsForm').style.display = 'block';
            document.getElementById('pomodoroControls').style.display = 'none';
        });

        function updateTimerDisplay() {
            var minutes = parseInt(currentTimer / 60, 10);
            var seconds = parseInt(currentTimer % 60, 10);

            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            document.querySelector('#timer').textContent = minutes + ":" + seconds;
        }

        function startTimer() {
            interval = setInterval(function() {
                if (--currentTimer < 0) {
                    clearInterval(interval);
                    isTimerRunning = false;
                    document.getElementById('pomodoroButton').textContent = 'Start Pomodoro';
                    // Handle completion of the timer here
                }
                updateTimerDisplay();
            }, 1000);
            isTimerRunning = true;
            document.getElementById('pomodoroButton').textContent = 'Pause Pomodoro';
        }

        function resetTimer() {
            currentTimer = workTime;
            updateTimerDisplay();
            clearInterval(interval);
            isTimerRunning = false;
            document.getElementById('pomodoroButton').textContent = 'Start Pomodoro';
        }

        function togglePomodoro() {
            if (!isTimerRunning) {
                applySettings();
            } else {
                clearInterval(interval);
                isTimerRunning = false;
                document.getElementById('pomodoroButton').textContent = 'Resume Pomodoro';
            }
        }

        function changeMode() {
            if (!workTime || !shortBreak || !longBreak) {
                alert("Please set the intervals first.");
                return;
            }

            clearInterval(interval);
            isTimerRunning = false;

            switch (mode) {
                case 'work':
                    currentTimer = shortBreak;
                    mode = 'shortBreak';
                    document.getElementById('modeButton').textContent = 'Long Break';
                    break;
                case 'shortBreak':
                    currentTimer = longBreak;
                    mode = 'longBreak';
                    document.getElementById('modeButton').textContent = 'Work Time';
                    break;
                case 'longBreak':
                    currentTimer = workTime;
                    mode = 'work';
                    document.getElementById('modeButton').textContent = 'Short Break';
                    break;
            }
            updateTimerDisplay();
        }

        function applySettings() {
            workTime = parseInt(document.getElementById('workInput').value) * 60;
            shortBreak = parseInt(document.getElementById('shortBreakInput').value) * 60;
            longBreak = parseInt(document.getElementById('longBreakInput').value) * 60;

            if (isNaN(workTime) || isNaN(shortBreak) || isNaN(longBreak) || workTime <= 0 || shortBreak <= 0 || longBreak <= 0) {
                alert('Please enter valid numbers greater than zero for all intervals.');
                return;
            }

            currentTimer = workTime;
            updateTimerDisplay();

            document.getElementById('settingsForm').style.display = 'none';
            document.getElementById('pomodoroControls').style.display = 'block';

            startTimer();
        }
    </script>
</body>
</html>
