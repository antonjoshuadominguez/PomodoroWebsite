<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="login-container">
        <h1>Welcome to the Pomodoro Tracker</h1>
        <!-- Always show Pomodoro Timer Display and Controls -->
        <div id="timer">25:00</div>
        <div id="pomodoroControls">
            <button id="pomodoroButton" type="button" onclick="togglePomodoro()">Start Pomodoro</button>
            <button id="modeButton" type="button" onclick="changeMode()">Short Break</button>
            <button type="button" onclick="resetTimer()">Reset Timer</button>
            <!-- Settings button is only shown if user is logged in -->
            {% if 'userid' in session %}
                <button id="toggleSettingsButton" onclick="toggleSettingsForm()">Settings</button>
            {% endif %}
        </div>

        <!-- Settings Form, hidden initially and only accessible if logged in -->
        <div id="settingsForm" style="display: none;">
            <form id="settingsForm" action="/start_pomodoro" method="post">
                <h2>Set Your Intervals</h2>
                <label>Work Interval (minutes): <input type="number" name="workInterval" id="workInput" value="25"></label><br>
                <label>Short Break (minutes): <input type="number" name="shortBreakInterval" id="shortBreakInput" value="5"></label><br>
                <label>Long Break (minutes): <input type="number" name="longBreakInterval" id="longBreakInput" value="15"></label><br>
                <input type="submit" value="Start Using Pomodoro">
            </form>
        </div>
    </div>

            <!-- Notes Button -->
    <div class="notes-button">
        <button onclick="toggleNotes()">Notes</button>
    </div>

    <!-- Container for Form and Table -->
    <div class="notes-container">
        <!-- Form to Add New Note -->
        <form action="{{ url_for('routes.add_note') }}" method="post">
            <textarea id="notesTextArea" name="note" rows="5" cols="33" placeholder="Write your notes here..."></textarea>
            <button type="submit">Save Note</button>
        </form>
    </div>

    <!-- Table to Display and Manage Existing Notes -->
    <div class="notes-table">
        <table>
            <tr>
                <th>Note</th>
                <th>Actions</th>
            </tr>
            {% for note in user_notes %}
            <tr>
                <td>{{ note.Note }}</td>
                <td>
                    <a href="{{ url_for('routes.delete_note', LogID=note.LogID) }}">Delete</a>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <div class="auth-container">
        {% if 'userid' not in session %}
            <p>If you wish to change the intervals, please log in or register.</p>
            <div class="auth-buttons">
                <a href="{{ url_for('routes.login') }}"><button>Login</button></a>
                <a href="{{ url_for('routes.register') }}"><button>Register</button></a>
            </div>
        {% else %}
            <a href="{{ url_for('routes.logout') }}"><button>Logout</button></a>
        {% endif %}
    </div>

    <div class="db-operations-container">
        <a href="{{ url_for('routes.user_settings') }}"><button>View User Settings</button></a>
        <a href="/sql_join"><button>SQL Join Operation</button></a>
        <a href="/stored_procedure"><button>Stored Procedure Execution</button></a>
        <a href="/trigger_operation"><button>Trigger Operation</button></a>
    </div>

    <script>
        var workTime = 25 * 60;  
    var shortBreak = 5 * 60; 
    var longBreak = 15 * 60;  
    var currentTimer = workTime;  
    var isTimerRunning = false;
    var interval;
    var mode = 'work'; 

    function updateTimerDisplay() {
        var minutes = Math.floor(currentTimer / 60);
        var seconds = currentTimer % 60;
        minutes = minutes < 10 ? '0' + minutes : minutes;
        seconds = seconds < 10 ? '0' + seconds : seconds;
        document.getElementById('timer').textContent = minutes + ':' + seconds;
    }

    function startTimer() {
        if (!isTimerRunning) {
            isTimerRunning = true;
            document.getElementById('pomodoroButton').textContent = 'Pause Pomodoro';
            interval = setInterval(function() {
                currentTimer--;
                updateTimerDisplay();
                if (currentTimer <= 0) {
                    clearInterval(interval);
                    isTimerRunning = false;
                    document.getElementById('pomodoroButton').textContent = 'Start Pomodoro';
                    // Change mode automatically if timer reaches zero
                    changeMode();
                }
            }, 1000);
        }
    }

    function resetTimer() {
        clearInterval(interval);
        isTimerRunning = false;
        document.getElementById('pomodoroButton').textContent = 'Start Pomodoro';
        if (mode === 'work') {
            currentTimer = workTime;
        } else if (mode === 'shortBreak') {
            currentTimer = shortBreak;
        } else {  // longBreak
            currentTimer = longBreak;
        }
        updateTimerDisplay();
    }

    function toggleSettingsForm() {
        var settingsForm = document.getElementById('settingsForm');
        var pomodoroControls = document.getElementById('pomodoroControls');
        if (settingsForm.style.display === 'none' || settingsForm.style.display === '') {
            settingsForm.style.display = 'block';
            pomodoroControls.style.display = 'none';
        } else {
            settingsForm.style.display = 'none';
            pomodoroControls.style.display = 'block';
        }
    }

    function toggleNotes() {
        var notesForm = document.getElementById('notesForm');
        if (notesForm.style.display === 'none' || notesForm.style.display === '') {
            notesForm.style.display = 'block';
        } else {
            notesForm.style.display = 'none';
        }
    }

    function togglePomodoro() {
        if (isTimerRunning) {
            clearInterval(interval);
            isTimerRunning = false;
            document.getElementById('pomodoroButton').textContent = 'Resume Pomodoro';
        } else {
            startTimer();
        }
    }

    function changeMode() {
        clearInterval(interval);
        isTimerRunning = false;
        switch (mode) {
            case 'work':
                currentTimer = shortBreak;
                mode = 'shortBreak';
                document.getElementById('modeButton').textContent = 'Long Break';
                break;
            case 'shortBreak':
                currentTimer = longBreak;
                mode = 'longBreak';
                document.getElementById('modeButton').textContent = 'Work Time';
                break;
            case 'longBreak':
                currentTimer = workTime;
                mode = 'work';
                document.getElementById('modeButton').textContent = 'Short Break';
                break;
        }
        updateTimerDisplay();
    }
        
    
        function applySettings() {
            workTime = parseInt(document.getElementById('workInput').value) * 60;
            shortBreak = parseInt(document.getElementById('shortBreakInput').value) * 60;
            longBreak = parseInt(document.getElementById('longBreakInput').value) * 60;
    
            if (isNaN(workTime) || isNaN(shortBreak) || isNaN(longBreak) || workTime <= 0 || shortBreak <= 0 || longBreak <= 0) {
                alert('Please enter valid numbers greater than zero for all intervals.');
                return;
            }
    
            currentTimer = workTime;
            updateTimerDisplay();
    
            document.getElementById('settingsForm').style.display = 'none';
            document.getElementById('pomodoroControls').style.display = 'block';
    
            startTimer();
        }
        updateTimerDisplay();
    </script>
    
</body>
</html>
